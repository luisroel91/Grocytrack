!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e=e||self).immer={})}(this,function(e){"use strict";var r,t="undefined"!=typeof Symbol?Symbol("immer-nothing"):((r={})["immer-nothing"]=!0,r),n="undefined"!=typeof Symbol?Symbol.for("immer-draftable"):"__$immer_draftable",o="undefined"!=typeof Symbol?Symbol.for("immer-state"):"__$immer_state";function i(e){return!!e&&!!e[o]}function a(e){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e))return!0;var r=Object.getPrototypeOf(e);return!r||r===Object.prototype||(!(!y(e)&&!b(e))||(!!e[n]||!!e.constructor[n]))}function f(e){if(e&&e[o])return e[o].base}var u=Object.assign||function(e){for(var r=[],t=arguments.length-1;t-- >0;)r[t]=arguments[t+1];return r.forEach(function(r){return Object.keys(r).forEach(function(t){return e[t]=r[t]})}),e},s="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function c(e,r){if(void 0===r&&(r=!1),Array.isArray(e))return e.slice();if(y(e))return new Map(e);if(b(e))return new Set(e);var t=Object.create(Object.getPrototypeOf(e));return s(e).forEach(function(n){if(n!==o){var i=Object.getOwnPropertyDescriptor(e,n),a=i.value;i.get&&r&&(a=i.get.call(e)),i.enumerable?t[n]=a:r&&Object.defineProperty(t,n,{value:a,writable:!0,configurable:!0})}}),t}function p(e,r){Array.isArray(e)||y(e)||b(e)?e.forEach(function(t,n){return r(n,t,e)}):s(e).forEach(function(t){return r(t,e[t],e)})}function l(e,r){var t=Object.getOwnPropertyDescriptor(e,r);return!!t&&t.enumerable}function d(e,r){return y(e)?e.has(r):Object.prototype.hasOwnProperty.call(e,r)}function h(e,r){return y(e)?e.get(r):e[r]}function v(e,r){return e===r?0!==e||1/e==1/r:e!=e&&r!=r}function y(e){return e instanceof Map}function b(e){return e instanceof Set}var g=function(e){this.drafts=[],this.parent=e,this.canAutoFreeze=!0,this.patches=null};function m(e){e[o].revoke()}g.prototype.usePatches=function(e){e&&(this.patches=[],this.inversePatches=[],this.patchListener=e)},g.prototype.revoke=function(){this.leave(),this.drafts.forEach(m),this.drafts=null},g.prototype.leave=function(){this===g.current&&(g.current=this.parent)},g.current=null,g.enter=function(){return this.current=new g(this.current)};var w={};function P(e,r){var t=Array.isArray(e),n=x(e);p(n,function(r){!function(e,r,t){var n=w[r];n?n.enumerable=t:w[r]=n={configurable:!0,enumerable:t,get:function(){return function(e,r){k(e);var t=j(z(e),r);if(e.finalizing)return t;if(t===j(e.base,r)&&a(t))return A(e),e.copy[r]=P(t,e);return t}(this[o],r)},set:function(e){!function(e,r,t){if(k(e),e.assigned[r]=!0,!e.modified){if(v(t,j(z(e),r)))return;E(e),A(e)}e.copy[r]=t}(this[o],r,e)}};Object.defineProperty(e,r,n)}(n,r,t||l(e,r))});var i,f,u,s=r?r.scope:g.current;return i=n,f=o,u={scope:s,modified:!1,finalizing:!1,finalized:!1,assigned:{},parent:r,base:e,draft:n,copy:null,revoke:O,revoked:!1},Object.defineProperty(i,f,{value:u,enumerable:!1,writable:!0}),s.drafts.push(n),n}function O(){this.revoked=!0}function z(e){return e.copy||e.base}function j(e,r){var t=e[o];if(t&&!t.finalizing){t.finalizing=!0;var n=e[r];return t.finalizing=!1,n}return e[r]}function E(e){e.modified||(e.modified=!0,e.parent&&E(e.parent))}function A(e){e.copy||(e.copy=x(e.base))}function x(e){var r=e&&e[o];if(r){r.finalizing=!0;var t=c(r.draft,!0);return r.finalizing=!1,t}return c(e)}function k(e){if(!0===e.revoked)throw new Error("Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+JSON.stringify(z(e)))}function D(e){for(var r=e.length-1;r>=0;r--){var t=e[r][o];t.modified||(Array.isArray(t.base)?F(t)&&E(t):S(t)&&E(t))}}function S(e){for(var r=e.base,t=e.draft,n=Object.keys(t),i=n.length-1;i>=0;i--){var a=n[i],f=r[a];if(void 0===f&&!d(r,a))return!0;var u=t[a],s=u&&u[o];if(s?s.base!==f:!v(u,f))return!0}return n.length!==Object.keys(r).length}function F(e){var r=e.draft;if(r.length!==e.base.length)return!0;var t=Object.getOwnPropertyDescriptor(r,r.length-1);return!(!t||t.get)}var R,M,I=Object.freeze({willFinalize:function(e,r,t){e.drafts.forEach(function(e){e[o].finalizing=!0}),t?i(r)&&r[o].scope===e&&D(e.drafts):(e.patches&&function e(r){if(r&&"object"==typeof r){var t=r[o];if(t){var n=t.base,i=t.draft,a=t.assigned;if(Array.isArray(r)){if(F(t)){if(E(t),a.length=!0,i.length<n.length)for(var f=i.length;f<n.length;f++)a[f]=!1;else for(var u=n.length;u<i.length;u++)a[u]=!0;for(var s=0;s<i.length;s++)void 0===a[s]&&e(i[s])}}else Object.keys(i).forEach(function(r){void 0!==n[r]||d(n,r)?a[r]||e(i[r]):(a[r]=!0,E(t))}),Object.keys(n).forEach(function(e){void 0!==i[e]||d(i,e)||(a[e]=!1,E(t))})}}}(e.drafts[0]),D(e.drafts))},createProxy:P});function N(e,r){var t=r?r.scope:g.current,n={scope:t,modified:!1,finalized:!1,assigned:{},parent:r,base:e,draft:null,drafts:{},copy:null,revoke:null},o=n,i=_;Array.isArray(e)?(o=[n],i=T):y(e)?(i=K,n.drafts=new Map,n.assigned=new Map):b(e)&&(i=L,n.drafts=new Map);var a=Proxy.revocable(o,i),f=a.revoke,u=a.proxy;return n.draft=u,n.revoke=f,t.drafts.push(u),u}var _={get:function(e,r){if(r===o)return e;var t=e.drafts;if(!e.modified&&d(t,r))return t[r];var n=J(e)[r];if(e.finalized||!a(n))return n;if(e.modified){if(n!==V(e.base,r))return n;t=e.copy}return t[r]=N(n,e)},has:function(e,r){return r in J(e)},ownKeys:function(e){return Reflect.ownKeys(J(e))},set:function(e,r,t){if(!e.modified){var n=V(e.base,r);if(t?v(n,t)||t===e.drafts[r]:v(n,t)&&r in e.base)return!0;q(e)}return e.assigned[r]=!0,e.copy[r]=t,!0},deleteProperty:function(e,r){return(void 0!==V(e.base,r)||r in e.base)&&(e.assigned[r]=!1,q(e)),e.copy&&delete e.copy[r],!0},getOwnPropertyDescriptor:function(e,r){var t=J(e),n=Reflect.getOwnPropertyDescriptor(t,r);return n&&(n.writable=!0,n.configurable=!Array.isArray(t)||"length"!==r),n},defineProperty:function(){throw new Error("Object.defineProperty() cannot be used on an Immer draft")},getPrototypeOf:function(e){return Object.getPrototypeOf(e.base)},setPrototypeOf:function(){throw new Error("Object.setPrototypeOf() cannot be used on an Immer draft")}},T={};p(_,function(e,r){T[e]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}}),T.deleteProperty=function(e,r){if(isNaN(parseInt(r)))throw new Error("Immer only supports deleting array indices");return _.deleteProperty.call(this,e[0],r)},T.set=function(e,r,t){if("length"!==r&&isNaN(parseInt(r)))throw new Error("Immer only supports setting array indices and the 'length' property");return _.set.call(this,e[0],r,t)};var C=["ownKeys","has","set","deleteProperty","defineProperty","getOwnPropertyDescriptor","preventExtensions","isExtensible","getPrototypeOf"].reduce(function(e,r){return e[r]=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return Reflect[r].apply(Reflect,[J(e)].concat(t))},e},{}),K=G(((R={})[o]=function(e){return e},R.size=function(e){return J(e).size},R.has=function(e){return function(r){return J(e).has(r)}},R.set=function(e){return function(r,t){var n=J(e);return n.has(r)&&n.get(r)===t||(q(e),e.assigned.set(r,!0),e.copy.set(r,t)),e.draft}},R.delete=function(e){return function(r){return!!J(e).has(r)&&(q(e),e.assigned.set(r,!1),e.copy.delete(r))}},R.clear=function(e){return function(){q(e),e.assigned=new Map;for(var r=0,t=J(e).keys();r<t.length;r+=1){var n=t[r];e.assigned.set(n,!1)}return e.copy.clear()}},R.forEach=function(e,r,t){return function(r,n){return J(e).forEach(function(e,o,i){var a=t.get(o);r.call(n,a,o,i)})}},R.get=function(e){return function(r){var t=e[e.modified?"copy":"drafts"];if(t.has(r))return t.get(r);var n=J(e).get(r);if(e.finalized||!a(n))return n;var o=N(n,e);return t.set(r,o),o}},R.keys=function(e){return function(){return J(e).keys()}},R.values=U,R.entries=U,R[Symbol.iterator]=U,R));function U(e,r,t){var n="values"!==r;return function(){var r=J(e)[Symbol.iterator]();return B(function(){var e=r.next();if(!e.done){var o=e.value[0],i=t.get(o);e.value=n?[o,i]:i}return e})}}var L=G(((M={})[o]=function(e){return e},M.size=function(e){return J(e).size},M.has=function(e){return function(r){return J(e).has(r)}},M.add=function(e){return function(r){return J(e).has(r)||(q(e),e.copy.add(r)),e.draft}},M.delete=function(e){return function(r){return q(e),e.copy.delete(r)}},M.clear=function(e){return function(){return q(e),e.copy.clear()}},M.forEach=function(e){return function(r,t){for(var n=$(e)(),o=n.next();!o.done;)r.call(t,o.value,o.value,e.draft),o=n.next()}},M.keys=$,M.values=$,M.entries=$,M[Symbol.iterator]=$,M));function $(e,r){var t="entries"===r;return function(){var r=J(e)[Symbol.iterator]();return B(function(){var n=r.next();if(!n.done){var o=function(e,r){var t=f(r)||r,n=e.drafts.get(t);if(!n){if(e.finalized||!a(r))return r;n=N(r,e),e.drafts.set(t,n),e.modified&&e.copy.add(n)}return n}(e,n.value);n.value=t?[o,o]:o}return n})}}function J(e){return e.copy||e.base}function V(e,r){var t=e[o],n=Reflect.getOwnPropertyDescriptor(t?J(t):e,r);return n&&n.value}function q(e){if(!e.modified){e.modified=!0;var r=e.base,t=e.drafts,n=e.parent,o=c(r);b(r)?(i=o,t.forEach(function(e){var r=f(e);r&&i.delete(r),i.add(e)})):(y(r)?function(e,r){r.forEach(function(r,t){return e.set(t,r)})}(o,t):u(o,t),e.drafts=null),e.copy=o,n&&q(n)}var i}function B(e){var r,t;return(r={})[Symbol.iterator]=function(){return t},r.next=e,t=r}function G(e){return Object.assign({},C,{get:function(r,t,n){return e.hasOwnProperty(t)?e[t](r,t,n):Reflect.get(r,t,n)},setPrototypeOf:function(e){throw new Error("Object.setPrototypeOf() cannot be used on an Immer draft")}})}var H=Object.freeze({willFinalize:function(){},createProxy:N});function Q(e,r,t,n){var o,i,a=e.base,f=e.copy,u=e.assigned;f.length<a.length&&(a=(o=[f,a])[0],f=o[1],t=(i=[n,t])[0],n=i[1]);for(var s=f.length-a.length,c=0;a[c]===f[c]&&c<a.length;)++c;for(var p=a.length;p>c&&a[p-1]===f[p+s-1];)--p;for(var l=c;l<p;++l)if(u[l]&&f[l]!==a[l]){var d=r.concat([l]);t.push({op:"replace",path:d,value:f[l]}),n.push({op:"replace",path:d,value:a[l]})}for(var h=p!=a.length,v=t.length,y=p+s-1;y>=p;--y){var b=r.concat([y]);t[v+y-p]={op:"add",path:b,value:f[y]},h&&n.push({op:"remove",path:b})}h||n.push({op:"replace",path:r.concat(["length"]),value:a.length})}function W(e,r,t,n){var o=e.base,i=e.copy;p(e.assigned,function(e,a){var f=h(o,e),u=h(i,e),s=a?d(o,e)?"replace":"add":"remove";if(f!==u||"replace"!==s){var c=r.concat(e);t.push("remove"===s?{op:s,path:c}:{op:s,path:c,value:u}),n.push("add"===s?{op:"remove",path:c}:"remove"===s?{op:"add",path:c,value:f}:{op:"replace",path:c,value:f})}})}function X(e,r,t,n){for(var o=e.base,i=e.copy,a=0,f=0,u=o;f<u.length;f+=1){var s=u[f];if(!i.has(s)){var c=r.concat([a]);t.push({op:"remove",path:c,value:s}),n.unshift({op:"add",path:c,value:s})}a++}a=0;for(var p=0,l=i;p<l.length;p+=1){var d=l[p];if(!o.has(d)){var h=r.concat([a]);t.push({op:"add",path:h,value:d}),n.unshift({op:"remove",path:h,value:d})}a++}}function Y(e,r){for(var t=0;t<r.length;t++){var n=r[t],o=n.path;if(0===o.length&&"replace"===n.op)e=n.value;else{for(var i=e,a=0;a<o.length-1;a++)if(!(i=h(i,o[a]))||"object"!=typeof i)throw new Error("Cannot apply patch, path doesn't resolve: "+o.join("/"));var f=o[o.length-1];switch(n.op){case"replace":!function(e,r){if(y(i))i.set(e,r);else{if(b(i))throw new Error('Sets cannot have "replace" patches.');i[e]=r}}(f,n.value);break;case"add":!function(e,r){Array.isArray(i)?i.splice(e,0,r):y(i)?i.set(e,r):b(i)?i.add(r):i[e]=r}(f,n.value);break;case"remove":!function(e,r){Array.isArray(i)?i.splice(e,1):y(i)?i.delete(e):b(i)?i.delete(r):delete i[e]}(f,n.value);break;default:throw new Error("Unsupported patch operation: "+n.op)}}}return e}var Z={useProxies:"undefined"!=typeof Proxy&&"undefined"!=typeof Reflect,autoFreeze:"undefined"!=typeof process?"production"!==process.env.NODE_ENV:"verifyMinified"===function(){}.name,onAssign:null,onDelete:null,onCopy:null},ee=function(e){u(this,Z,e),this.setUseProxies(this.useProxies),this.produce=this.produce.bind(this)};ee.prototype.produce=function(e,r,n){var o,i=this;if("function"==typeof e&&"function"!=typeof r){var f=r;r=e;var u=this;return function(e){var t=this;void 0===e&&(e=f);for(var n=[],o=arguments.length-1;o-- >0;)n[o]=arguments[o+1];return u.produce(e,function(e){return r.call.apply(r,[t,e].concat(n))})}}if("function"!=typeof r)throw new Error("The first or second argument to `produce` must be a function");if(void 0!==n&&"function"!=typeof n)throw new Error("The third argument to `produce` must be a function or undefined");if(a(e)){var s=g.enter(),c=this.createProxy(e),p=!0;try{o=r(c),p=!1}finally{p?s.revoke():s.leave()}return o instanceof Promise?o.then(function(e){return s.usePatches(n),i.processResult(e,s)},function(e){throw s.revoke(),e}):(s.usePatches(n),this.processResult(o,s))}return void 0===(o=r(e))?e:o!==t?o:void 0},ee.prototype.createDraft=function(e){if(!a(e))throw new Error("First argument to `createDraft` must be a plain object, an array, or an immerable object");var r=g.enter(),t=this.createProxy(e);return t[o].isManual=!0,r.leave(),t},ee.prototype.finishDraft=function(e,r){var t=e&&e[o];if(!t||!t.isManual)throw new Error("First argument to `finishDraft` must be a draft returned by `createDraft`");if(t.finalized)throw new Error("The given draft is already finalized");var n=t.scope;return n.usePatches(r),this.processResult(void 0,n)},ee.prototype.setAutoFreeze=function(e){this.autoFreeze=e},ee.prototype.setUseProxies=function(e){this.useProxies=e,u(this,e?H:I)},ee.prototype.applyPatches=function(e,r){return i(e)?Y(e,r):this.produce(e,function(e){return Y(e,r)})},ee.prototype.processResult=function(e,r){var n=r.drafts[0],i=void 0!==e&&e!==n;if(this.willFinalize(r,e,i),i){if(n[o].modified)throw r.revoke(),new Error("An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.");a(e)&&(e=this.finalize(e,null,r)),r.patches&&(r.patches.push({op:"replace",path:[],value:e}),r.inversePatches.push({op:"replace",path:[],value:n[o].base}))}else e=this.finalize(n,[],r);return r.revoke(),r.patches&&r.patchListener(r.patches,r.inversePatches),e!==t?e:void 0},ee.prototype.finalize=function(e,r,t){var n=this,i=e[o];if(!i)return Object.isFrozen(e)?e:this.finalizeTree(e,null,t);if(i.scope!==t)return e;if(!i.modified)return i.base;if(!i.finalized){if(i.finalized=!0,this.finalizeTree(i.draft,r,t),this.onDelete&&!b(i.base))if(this.useProxies){p(i.assigned,function(e,r){r||n.onDelete(i,e)})}else{var a=i.base,f=i.copy;p(a,function(e){d(f,e)||n.onDelete(i,e)})}this.onCopy&&this.onCopy(i),this.autoFreeze&&t.canAutoFreeze&&Object.freeze(i.copy),r&&t.patches&&function(e,r,t,n){(Array.isArray(e.base)?Q:b(e.base)?X:W)(e,r,t,n)}(i,r,t.patches,t.inversePatches)}return i.copy},ee.prototype.finalizeTree=function(e,r,t){var n=this,f=e[o];f&&(this.useProxies||(f.copy=c(f.draft,!0)),e=f.copy);var u=!!r&&!!t.patches,s=function(o,c,g){if(c===g)throw Error("Immer forbids circular references");var m=!!f&&g===e,w=b(g);if(i(c)){var P=m&&u&&!w&&!d(f.assigned,o)?r.concat(o):null;if(function(e,r,t){y(e)?e.set(r,t):b(e)?(e.delete(r),e.add(t)):Array.isArray(e)||l(e,r)?e[r]=t:Object.defineProperty(e,r,{value:t,writable:!0,configurable:!0})}(g,o,c=n.finalize(c,P,t)),i(c)&&(t.canAutoFreeze=!1),m&&c===h(f.base,o))return}else{if(m&&v(c,h(f.base,o)))return;a(c)&&!Object.isFrozen(c)&&p(c,s)}m&&n.onAssign&&!w&&n.onAssign(f,o,c)};return p(e,s),e};var re=new ee,te=re.produce,ne=re.setAutoFreeze.bind(re),oe=re.setUseProxies.bind(re),ie=re.applyPatches.bind(re),ae=re.createDraft.bind(re),fe=re.finishDraft.bind(re);e.Immer=ee,e.applyPatches=ie,e.createDraft=ae,e.default=te,e.finishDraft=fe,e.immerable=n,e.isDraft=i,e.isDraftable=a,e.nothing=t,e.original=f,e.produce=te,e.setAutoFreeze=ne,e.setUseProxies=oe,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=immer.umd.js.map
